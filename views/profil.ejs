<%- include('partials/header.ejs') %>
<%- include('partials/navbar.ejs') %>

<div class="container">

    <!-- Profil modifié -->
    <% if (messageUpdateSuccess.length > 0) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= messageUpdateSuccess %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } %>

    <!-- Erreur : pas d'images sélectionnée pour le profil -->
    <% if (noImage.length > 0) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= noImage %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } %>

    <div class="row">
        <a href="/updateProfil/<%= userProfil.userId %> ">
            Modifier le profil
        </a>
        <form action="/deleteProfil/<%= userProfil.userId %>?_method=DELETE" method="POST">
            <button type="submit" class="btn btn-danger">Supprimer</button>
        </form>
        <p>Nom : <%= userProfil.lastname %></p>
        <p>Prénom : <%= userProfil.firstname %></p>
        <p>Adresse mail : <%= userProfil.email %></p>
        <img style="width: 50px;" src="/uploads/profil/<%= userProfil.profilPicture %> ">

        <!-- Ajouter une photo de profil -->
        <form action="/addProfilPicture/<%= userProfil.userId %>?_method=PUT" method="post"
            enctype="multipart/form-data">
            <input class="form-control" type="file" id="formFile" name="image">
            <button class="btn btn-primary" type="submit">Ajouter</button>
        </form>

        <!-- Supprimer une photo de profil -->
        <form action="/deleteProfilPicture/<%= userProfil.userId %>?_method=DELETE" method="post"
            enctype="multipart/form-data">
            <button class="btn btn-danger" type="submit">Supprimer votre photo de profil</button>
        </form>
    </div>

</div>
</div>

<div class="container">
    <div class="row">
        <h2>Historique des articles</h2>
        <div class="col">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">id</th>
                        <th scope="col">Photos</th>
                        <th scope="col">Noms</th>
                        <th scope="col">Détails</th>
                        <th scope="col">Modifier</th>
                        <th scope="col">Supprimer</th>
                    </tr>
                </thead>
                <tbody>
                    <% articles.forEach(article => { %>
                    <tr>
                        <th scope="row"><%= article.articleId %></th>
                        <td><img src="/uploads/<%= article.image %>" class="img-thumbnail" alt=""></td>
                        <td><%= article.titre %></td>
                        <td>
                            <a href="/liste-des-articles/<%= article.articleId %> " class="btn btn-primary">Détails</a>
                        </td>
                        <td>
                            <a href="/updateArticle/<%= article.articleId %>" class="btn btn-warning">Modifier</a>
                        </td>
                        <td>
                            <form action="/delete/<%= article.articleId %>?_method=DELETE" method="POST">
                                <button type="submit" class="btn btn-danger">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<%- include('partials/footer.ejs') %>